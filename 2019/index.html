<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script>
      let locations = [];

      fetch("/api/locations")
        .then(function (response) {
          if (response.status !== 200) {
            console.warn(`Status Code: ${response.status} at /api/locations`);
            return;
          }
          response.json().then((data) => {
            locations = data;
          });
        })
        .catch((err) => {
          console.error(`Fetch Error at /api/locations, \n error: ${err}`);
        });

      fetch("/api/dates")
        .then(function (response) {
          if (response.status !== 200) {
            console.warn(`Status Code: ${response.status} at /api/dates`);
            return;
          }
          response.json().then((data) => {
            let dropdown = document.getElementById("date-dropdown");
            data.sort();
            let option;
            for (let i = 0; i < data.length; i++) {
              option = document.createElement("option");
              option.text = data[i];
              option.value = data[i];
              dropdown.add(option);
            }

            changeTimes(data[0]);
          });
        })
        .catch((err) => {
          console.error(`Fetch Error at /api/dates, \n error: ${err}`);
        });

      function changeTimes(date) {
        let timedropdown = document.getElementById("time-dropdown");
        timedropdown.innerText = null;

        fetch(`/api/getdatetimes/${date}`)
          .then(function (response) {
            if (response.status !== 200) {
              console.warn(
                `Status Code: ${response.status} at /api/getdatetimes/${date}`
              );
              return;
            }

            response.json().then(function (data) {
              data.sort();
              let option;
              for (let i = 0; i < data.length; i++) {
                option = document.createElement("option");
                option.text = data[i];
                option.value = data[i];
                timedropdown.add(option);
              }
            });
          })
          .catch(function (err) {
            console.error(
              `Fetch Error at /api/getdatetimes/${date}, \n error: ${err}`
            );
          });
      }
    </script>
  </head>
  <body>
    <form action="/api/getobjects/">
      <label for="date-dropdown">Date:</label>
      <select
        id="date-dropdown"
        name="date"
        onChange="changeTimes(this.value)"
      ></select>
      <label for="time-dropdown">Time:</label>
      <select id="time-dropdown" name="time"></select>
      <input type="submit" />
    </form>
  </body>
</html>
